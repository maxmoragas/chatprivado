<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Chat Privado</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
    <script>
        // 游댠 Inicializaci칩n de Firebase con tu configuraci칩n
        const firebaseConfig = {
            apiKey: "AIzaSyCalxt34jrPFP9VJM5yBFA4BRF2U1_XiZw",
            authDomain: "michatprivado-f704a.firebaseapp.com",
            databaseURL: "https://michatprivado-f704a.firebaseio.com",
            projectId: "michatprivado-f704a",
            storageBucket: "michatprivado-f704a.appspot.com",
            messagingSenderId: "187774286181",
            appId: "1:187774286181:web:95fc9391a64d3d244e498c"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #chatContainer { max-width: 400px; margin: auto; padding: 10px; border: 1px solid #ddd; }
        img { max-width: 200px; }
    </style>
</head>
<body>
    <h2>Mi Chat Privado</h2>

    <!-- Nickname Input -->
    <input type="text" id="nicknameInput" placeholder="Tu nombre">
    <button id="setNickname">Guardar Nickname</button>

    <!-- Chat Messages -->
    <div id="chatContainer"></div>

    <!-- Input para mensajes de texto -->
    <input type="text" id="messageInput" placeholder="Escribe un mensaje">
    <button id="sendMessage">Enviar</button>

    <!-- Input para im치genes -->
    <input type="file" id="imageInput" accept="image/*">

    <script>
        // 游댠 Guardar el nickname en LocalStorage
        document.getElementById("setNickname").addEventListener("click", () => {
            const nickname = document.getElementById("nicknameInput").value;
            if (nickname.trim() !== "") {
                localStorage.setItem("nickname", nickname);
            }
        });

        // 游댠 Enviar mensajes de texto a Firebase
        document.getElementById("sendMessage").addEventListener("click", () => {
            const messageText = document.getElementById("messageInput").value;
            if (messageText.trim() !== "") {
                firebase.database().ref("messages").push({
                    text: messageText,
                    sender: localStorage.getItem("nickname") || "Anon"
                });
                document.getElementById("messageInput").value = ""; // Limpia el campo
            }
        });

        // 游댠 Enviar im치genes a Firebase en Base64
        document.getElementById("imageInput").addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    firebase.database().ref("messages").push({
                        image: reader.result,
                        sender: localStorage.getItem("nickname") || "Anon"
                    });
                };
            }
        });

        // 游댠 Cargar mensajes en el chat
        firebase.database().ref("messages").on("child_added", (snapshot) => {
            const message = snapshot.val();
            const messageContainer = document.createElement("div");

            if (message.text) {
                messageContainer.innerHTML = `<p><strong>${message.sender}:</strong> ${message.text}</p>`;
            }

            if (message.image) {
                const imgElement = document.createElement("img");
                imgElement.src = message.image;
                messageContainer.appendChild(imgElement);
            }

            document.getElementById("chatContainer").appendChild(messageContainer);
        });
    </script>
</body>
</html>
